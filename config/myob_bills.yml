---
swagger: '2.0'

info:
  version: "1.0.3"
  title: 'Bills'
  description: |
    ## List, view, create, update and delete bills.
    ## List, download, upload and delete attachments.
  
schemes:
 - https
 
paths:

  '/businesses/{businessId}/purchases/bills':
    
    post:
      description: | 
        ### Create a bill for a given business.
        
      operationId: "createBill"
      
        
      consumes:
        - "application/vnd.api+json"
      produces:
        - "application/vnd.api+json"
        
      parameters:
      
      - $ref: '#/parameters/businessId'
      
      - name: "body"
        in: "body"
        description: "JSON representation of the new bill to be created"
        required: true
        schema: 
          $ref: "#/definitions/CreateBillDetail"
          
      responses:
        201:
          description: "Successfully created"
          schema:
            $ref: "#/definitions/BillDetailResponse"
          headers:
            Location:
              description: "URL pointing to newly created bill"
              type: string
        400:
          $ref: '#/responses/BadRequest'
        401:
          $ref: "#/responses/Unauthorised"
        403:
          $ref: '#/responses/Forbidden'
        406:
          $ref: '#/responses/MediaTypeUnAccepted'
        415:
          $ref: '#/responses/UnsupportedMediaType'
        500:
          $ref: '#/responses/InternalError'
          
    get:
      description: | 
        ### Returns a list of bills for a given business.
        
      operationId: "listBills"
        
      consumes:
        - "application/vnd.api+json"
      produces:
        - "application/vnd.api+json"
      
      parameters:
        
        - $ref: '#/parameters/businessId'
        
        - name: "status"
          in: "query"
          required: false
          type: "string"
          enum:
            - "OPEN"
            - "CLOSED"
            - "RETURNS"
          description: "filter by bill status"
          x-example: "OPEN"
          
        - name: "billNumber"
          in: "query"
          type: string
          required: false
          description: "filter by a bill number, note that the billNumber filter parameter can only be used by it self, it cannot be used in conjuction with other filter parameters"
          x-example: "1"
        
        - name: "supplierId"
          in: "query"
          type: string
          required: false
          description: "filter by supplier, using their ID"
          x-example: "1"
        
        - name: "dateIssuedFrom"
          in: "query"
          required: false
          type: string
          format: "full-date"
          description: "Only include bills with an issue date after or on this dates"
          x-example: "2016-12-31"
        
        - name: "dateIssuedTo"
          in: "query"
          required: false
          type: "string"
          format: "full-date"
          description: "Only include bills with an issue date before or on this date"
          x-example: "2017-12-31"
        
        - name: "dateDueFrom"
          in: "query"
          required: false
          type: string
          format: "full-date"
          description: "Only include bills with a due date after or on this dates"
          x-example: "2016-12-31"
        
        - name: "dateDueTo"
          in: "query"
          required: false
          type: "string"
          format: "full-date"
          description: "Only include bills with a due date before or on this date"
          x-example: "2017-12-31"
          
        - name: "sort"
          in: "query"
          required: false
          type: "string"
          enum: 
            - "dateIssued"
            - "-dateIssued"
            - "dateDue"
            - "-dateDue"
          description: "Apply sorting to the list of bills. Only the following sorting is currently supported, 'dateIssued' (ascending), '-dateIssued' (descending), dateDue (ascending) and '-dateDue' (descending)."
          x-example: "dateIssued"
        
        - name: "pageNumber"
          in: "query"
          description: "The page number of the results to retrieve, defaults to 1"
          required: false
          type: "integer"
          format: "int32"
          x-example: "1"
          minimum: 0
          default: 1
        
        - name: "pageSize"
          in: "query"
          description: "The page size to indicate the number of results to retrieve per page, default to 400, maximum 1000"
          required: false
          type: "integer"
          format: "int32"
          x-example: "2"
          minimum: 0
          maximum: 1000
          default: 400
          
      responses:
        200:
          description: "200 response"
          schema:
            $ref: "#/definitions/BillListResponse"
        400:
          $ref: '#/responses/BadRequest'
        401:
          $ref: "#/responses/Unauthorised"
        403:
          $ref: '#/responses/Forbidden'
        406:
          $ref: '#/responses/MediaTypeUnAccepted'
        500:
          $ref: '#/responses/InternalError'
          
  '/businesses/{businessId}/purchases/bills/{billId}':
    
    get:
      description: | 
        ### Get an individual bill for a given business by its ID.
        
      operationId: "getBill"
        
      consumes:
        - "application/vnd.api+json"
      produces:
        - "application/vnd.api+json"
        
      parameters:
      
        - $ref: '#/parameters/businessId' 
        - $ref: '#/parameters/billId'
          
      responses:
        200:
          description: "200 response"
          schema:
            $ref: "#/definitions/BillDetailResponse"
        400:
          $ref: '#/responses/BadRequest'
        401:
          $ref: "#/responses/Unauthorised"
        403:
          $ref: '#/responses/Forbidden'
        404:
          $ref: '#/responses/NotFound'
        406:
          $ref: '#/responses/MediaTypeUnAccepted'
        500:
          $ref: '#/responses/InternalError'
          
    delete:
      description: | 
        ### Delete a bill for a given business.
        
      operationId: "deleteBill"
      
      parameters:
        - $ref: '#/parameters/businessId'
        - $ref: '#/parameters/billId'
        
      responses:
        204:
          description: "Successful deletion, no content (empty body)"
        400:
          $ref: '#/responses/BadRequest'
        401:
          $ref: "#/responses/Unauthorised"
        403:
          $ref: '#/responses/Forbidden'
        500:
          $ref: '#/responses/InternalError'

  '/businesses/{businessId}/purchases/bills/{billId}/attachments':
    
    post:
      description: | 
        ### Upload an attachment for a given bill.
        
      operationId: "uploadAttachment"
      
        
      consumes:
        - "multipart/form-data"

      parameters:
      
      - $ref: '#/parameters/businessId'
      - $ref: '#/parameters/billId'
      - in: formData
        name: file
        type: file
        required: true
        description: The file to upload.
          
      responses:
        201:
          description: "Successfully created"
          headers:
            Location:
              description: "URL pointing to newly created attachment"
              type: string
        400:
          $ref: '#/responses/BadRequest'
        401:
          $ref: "#/responses/Unauthorised"
        403:
          $ref: '#/responses/Forbidden'
        406:
          $ref: '#/responses/MediaTypeUnAccepted'
        415:
          $ref: '#/responses/UnsupportedMediaType'
        500:
          $ref: '#/responses/InternalError'

    get:
      description: | 
        ### Get List of attachments for a given bill.
        
      operationId: "listAttachments"
        
      produces:
        - "application/vnd.api+json"
        
      parameters:
      
        - $ref: '#/parameters/businessId' 
        - $ref: '#/parameters/billId'
          
      responses:
        200:
          description: "200 response"
          schema:
            $ref: "#/definitions/AttachmentListResponse"
        400:
          $ref: '#/responses/BadRequest'
        401:
          $ref: "#/responses/Unauthorised"
        403:
          $ref: '#/responses/Forbidden'
        406:
          $ref: '#/responses/MediaTypeUnAccepted'
        500:
          $ref: '#/responses/InternalError'

  '/businesses/{businessId}/purchases/bills/{billId}/attachments/{attachmentId}':

    get:
      description: | 
        ### Download an attachment for a given business and bill by its ID
        
      operationId: "downloadAttachment"
        
      produces:
        - "application/pdf"
        - "application/vnd.api+json"
        
      parameters:
      
        - $ref: '#/parameters/businessId' 
        - $ref: '#/parameters/billId'
        - $ref: '#/parameters/attachmentId'
          
      responses:
        400:
          $ref: '#/responses/BadRequest'
        401:
          $ref: "#/responses/Unauthorised"
        403:
          $ref: '#/responses/Forbidden'
        404:
          $ref: '#/responses/NotFound'
        406:
          $ref: '#/responses/MediaTypeUnAccepted'
        500:
          $ref: '#/responses/InternalError'
          
    delete:
      description: | 
        ### Unlink an attachment for a given bill by its ID
        
      operationId: "unlinkAttachment"
        
      parameters:
      
        - $ref: '#/parameters/businessId' 
        - $ref: '#/parameters/billId'
        - $ref: '#/parameters/attachmentId'
          
      responses:
        204:
          description: "Successful deletion, no content (empty body)"
        400:
          $ref: '#/responses/BadRequest'
        401:
          $ref: "#/responses/Unauthorised"
        403:
          $ref: '#/responses/Forbidden'
        404:
          $ref: '#/responses/NotFound'
        406:
          $ref: '#/responses/MediaTypeUnAccepted'
        500:
          $ref: '#/responses/InternalError'
  
          
definitions:


  AttachmentListResponse:
    type: object
    required: 
      - "data"
    properties:
      data:
        type: "array"
        items:
          $ref: "#/definitions/AttachmentSummary"
          
  AttachmentSummary:
    type: object
    required:
      - "id"
      - "type"
      - "links"
    properties:
      id:
        type: string
        example: "1"
      type:
        type: string
        enum: 
          - "attachment"
        example: "attachment"
      links:
        type: object
        properties:
          self:
            type: object
            description: "A URI to access full details of this bill"
            properties:
              href: 
                type: string
                example: "/businesses/1/purchases/bills/2/attachments/3"
        required:
          - "self"

  BillListResponse:
    type: object
    required: 
      - "data"
      - "links"
    properties:
      data:
        type: "array"
        items:
          $ref: "#/definitions/BillSummary"
      links:
        type: object
        properties:
          self:
            type: object
            description: "A URI which generated this response"
            properties:
              href: 
                type: string
                example: "/businesses/1/purchases/bills?pageNumner=2&pageSize=10"
          first:
            type: object
            description: "A link to the first page of results"
            properties:
              href: 
                type: string
                example: "/businesses/1/purchases/bills?pageNumber=1&pageSize=10"
          last:
            type: object
            description: "A link to the last page of results"
            properties:
              href: 
                type: string
                example: "/businesses/1/purchases/bills?pageNumber=3&pageSize=10"
          next:
            type: object
            description: "A link to the next page of results"
            properties:
              href: 
                type: string
                example: "/businesses/1/purchases/bills?pageNumber=3&pageSize=10"
          prev:
            type: object
            description: "A link to the previous page of results"
            properties:
              href: 
                type: string
                example: "/businesses/1/purchases/bills?pageNumber=1&pageSize=10"
        required:
          - "self"
          
  BillSummary:
    type: object
    required:
      - "attributes"
      - "id"
      - "type"
      - "links"
    properties:
      id:
        type: string
        example: "1"
      type:
        type: string
        enum: 
          - "bill"
        example: "bill"
      links:
        type: object
        properties:
          self:
            type: object
            description: "A URI to access full details of this bill"
            properties:
              href: 
                type: string
                example: "/businesses/1/purchases/bills/1"
      attributes:
        $ref: '#/definitions/BillSummaryAttributes'
        
  BillSummaryAttributes:
    type: object
    properties:
      totalAmount:
        type: number
        description: "The total amount of all line items on the bill"
        minimum: 0.0
        example: 110
      taxAmount:
        type: number
        description: "The tax portion of the total amount"
        minimum: 0
        example: 10
      isGstInclusive:
        type: boolean
        description: "Indicates whether the bill is GST inclusive"
        example: true
      billNumber: 
        type: string
        description: "The unique number that is attached to the bill"
        maxLength: 13
        example: "EX00000000001"
      dateIssued:
        type: string
        description: "Date when the bill was issued"
        format: "full-date"
        example: "2016-12-13"
      dateDue:
        type: string
        description: "The date that the bill is due to be paid on"
        format: "full-date"
        example: "2017-01-10"
      amountPaid:
        type: number
        description: "The amount of the bill that has been paid so far"
        minimum: 0.0
        example: 50
      amountDue:
        type: number
        description: "The amount of the bill still left to be paid"
        minimum: 0.0
        example: 60
      status:
        type: string
        description: "bill status depending if it is not paid, paid or overpaid"
        enum:
          - "OPEN"
          - "CLOSED"
          - "RETURNS"
        example: "OPEN"
      notes:
        type: string
        description: "This is any notes that have been left attached to the bill"
        example: "Partially paid"
      supplier:
        type: object
        description: "A reference to the supplier"
        properties:
          id:
            type: string
            example: "1"
        required:
          - "id"
      supplierInvoiceNumber:
        type: string
        description: "A reference number from the supplier..TBC. -> confirm this description"
        maxLength: 20
        example: 'ABC-123'
    required:
      - "totalAmount"
      - "billNumber"
      - "dateIssued"
      - "dateDue"
      - "amountPaid"
      - "amountDue"
      - "status"
      - "isGstInclusive"
      - "supplier"
  
  BillDetailResponse:
    type: object
    required: 
      - "data"
      - "links"
    properties:
      data:
        $ref: '#/definitions/BillDetail'
      links:
        type: object
        properties:
          self:
            type: object
            description: "A URI which generated this response"
            properties:
              href: 
                type: string
                example: "/businesses/1/purchases/bills/1"
        required:
        - "self"
        
  BillDetail:
    type: object
    required:
      - "attributes"
      - "id"
      - "type"
    properties:
      id:
        type: string
        example: "1"
      type:
        type: string
        enum: 
          - "bill"
        example: "bill"
      attributes:
        $ref: "#/definitions/BillDetailAttributes"
        
  BillDetailAttributes:
    type: object
    properties:
      totalAmount:
        type: number
        description: "The total amount of all line items on the bill"
        minimum: 0.0
        example: 110
      taxAmount:
        type: number
        description: "The tax portion of the total amount"
        minimum: 0
        example: 10
      isGstInclusive:
        type: boolean
        description: "Indicates whether the bill is GST inclusive"
        example: true
      billNumber: 
        type: string
        description: "The unique number that is attached to the bill"
        example: "EX00000000001"
        maxLength: 13
      dateIssued:
        type: string
        description: "Date when the bill was issued"
        format: "full-date"
        example: "2016-12-13"
      dateDue:
        type: string
        description: "The date that the bill is due to be paid on"
        format: "full-date"
        example: "2017-01-10"
      amountPaid:
        type: number
        description: "The amount of the bill that has been paid so far"
        minimum: 0.0
        example: 50
      amountDue:
        type: number
        description: "The amount of the bill still left to be paid"
        minimum: 0.0
        example: 60
      isTaxPaymentsReportable:
        type: boolean
        default: false
        description: "https://www.ato.gov.au/General/Other-languages/In-detail/Information-in-other-languages/Taxable-payments-reporting---building-and-construction-industry/"
        example: false
      status:
        type: string
        description: "bill status depending if it is not paid, paid or overpaid"
        enum:
          - "OPEN"
          - "CLOSED"
          - "RETURNS"
        example: "OPEN"
      notes:
        type: string
        description: "This is any notes that have been left attached to the bill"
        example: "Partially paid"
      supplier:
        type: object
        description: "A reference to the supplier"
        properties:
          id:
            type: string
            example: "1"
        required:
          - "id"
      supplierInvoiceNumber:
        type: string
        description: "A reference number from the supplier..TBC. -> confirm this description"
        maxLength: 20
        example: 'ABC-123'
      lineItems:
        type: array
        items: 
          $ref: "#/definitions/BillLineItem"
    required:
      - "totalAmount"
      - "billNumber"
      - "dateIssued"
      - "dateDue"
      - "amountPaid"
      - "amountDue"
      - "lineItems"
      - "status"
      - "isGstInclusive"
      - "supplier"
      
  BillLineItem:
    type: object
    description: "A line item on a bill"
    properties:
      description:
        type: string
        description: "The description of the specific line item"
        example: "Socks"
      account:
        type: object
        description: "The account which money to be debited...TBC -> Bill means business gets debited?"
        properties:
         id:
          type: string
          description: "The identifier for the linked account"
          example: "1"
        required:
          - "id"
      inventoryItem:
        type: object
        description: "An optional reference to an inventory item"
        properties:
          id:
            type: string
            description: "The identifier for the linked inventory item"
            example: "1"
      taxType:
        description: "A reference to the tax information"
        type: string
        enum: 
          - "S"
          - "Z"
          - "E"
          - "I"
          - "ABN"
          - "CAP"
          - "EXP"
          - "FRE"
          - "GNR"
          - "GST"
          - "INP"
          - "ITS"
          - "NTR"
          - "S15"
        example: "GST"
      quantity:
        type: number
        description: "The amount of this item that has been added to the bill, can contain fractions, upto a maximum of 4 decimal places"
        minimum: 0.0
        maximum: 999999.99
        example: 2
      unitPrice:
        type: number
        description: "The individual price of this item, can contain fractions, upto a maximum of 4 decimal places"
        minimum: 0.0
        maximum: 99999999.99
        example: 5
      amount:
        type: number
        description: "The total amount it would cost for multiple of this item"
        minimum: 0.0
        maximum: 99999999.99
        example: 10
    required: 
      - "account"
      - "quantity"
      - "unitPrice"
      - "amount"
          
  CreateBillDetail:
    type: object
    required:
      - "data"
      
    properties:
      data:
        type: object
        required:
         - "type"
         - "attributes"
        properties:
          type: 
            type: string

            description: "Resource type per JSON API spec"
            example: "bill"
          attributes:
            $ref: "#/definitions/CreateBillDetailAttributes"
            
  CreateBillDetailAttributes:
    type: object
    properties:
      billNumber: 
        type: string
        description: "The unique number that is attached to the bill"
        maxLength: 13
        example: "EX00000000001"
      dateDue:
        type: string
        description: "The date that the bill is due to be paid on"
        format: "full-date"
        example: "2017-01-10"
      dateIssued:
        type: string
        description: "Date when the bill was issued"
        format: "full-date"
        example: "2016-12-13"
      isGstInclusive:
        type: boolean
        description: "Indicates whether the bill is GST inclusive"
        example: true
      lineItems:
        type: array
        items: 
          $ref: "#/definitions/CreateBillLineItem"
        minItems: 1
        maxItems: 3000
      notes:
        type: string
        description: "This is any notes that have been left attached to the invoice"
        maxLength: 2000
        example: "Due immediately"
      supplier:
        type: object
        description: "A reference to the supplier"
        properties:
          id:
            type: string
            example: "1"
        required:
          - "id"
      supplierInvoiceNumber:
        type: string
        description: "A reference number from the supplier..TBC. -> confirm this description"
        maxLength: 20
        example: "BU-0001"
      isTaxPaymentsReportable:
        type: boolean
        default: false
        example: false
        description: "https://www.ato.gov.au/General/Other-languages/In-detail/Information-in-other-languages/Taxable-payments-reporting---building-and-construction-industry/"
    required: 
      - "supplier"
      - "dateIssued"
      - "dateDue"
      - "isGstInclusive"
      - "lineItems"
  
  CreateBillLineItem:
    type: object
    required:
      - "quantity"
      - "unitPrice"
      - "account"
    properties:
      account:
        type: object
        description: "The account which money to be debited."
        properties:
          id:
            type: string
            example: "1"
        required:
          - "id"
      description:
        type: string
        description: "The description of the specific line item"
        maxLength: 1000
        example: "Socks"
      inventoryItem:
        type: object
        description: "An optional reference to an inventory item"
        properties:
          id:
            type: string
            description: "The identifier for the linked inventory item"
            example: "1"
      quantity:
        type: number
        description: "The amount of this item that has been added to the bill, can contain fractions, upto a maximum of 4 decimal places"
        minimum: 0.0
        maximum: 999999.99
        example: 2
      taxType:
        description: "A reference to the tax information. This is required if the business is registered for GST, if not do not provide this."
        type: string
        enum: 
          - "S"
          - "Z"
          - "E"
          - "I"
          - "ABN"
          - "CAP"
          - "EXP"
          - "FRE"
          - "GNR"
          - "GST"
          - "INP"
          - "ITS"
          - "NTR"
          - "S15"
        example: "GST"
      unitPrice:
        type: number
        description: "The individual price of this item, can contain fractions, upto a maximum of 4 decimal places"
        minimum: 0.0
        maximum: 99999999.99
        example: 5
  
  ErrorResponse:
    type: object
    properties:
      errors:
        type: array
        items:
          type: object
          required:
            - "detail"
          properties:
            detail:
              description: "A human-readable explanation specific to this occurrence of the problem."
              type: string
              example: "dateDue is missing"
            source:
              type: object
              properties:
                pointer:
                  description: A JSON Pointer [RFC6901] to the associated entity in the request document [e.g. "/data" for a primary data object, or "/data/attributes/title"
                    for a specific attribute].
                  type: string
                  example: "dateDue"
            
parameters:
  
  businessId:
    name: "businessId"
    in: "path"
    required: true
    type: string
    description: "The unique identifier for the business you are requesting data from"
    x-example: 989898
    
  billId:  
    name: "billId"
    description: "The unique identifier for the bill"
    in: "path"
    required: true
    type: string
    x-example: 111
    
  attachmentId:
    name: "attachmentId"
    description: "The unique identifier for the bill"
    in: "path"
    required: true
    type: string
    x-example: "X00789"

responses:
  'BadRequest':
    description: "Input validation error"
    schema:
      $ref: '#/definitions/ErrorResponse'
  'NotFound':
    description: "The resource your are trying to access does not exist, no detail given (empty body)"
  'Unauthorised':
    description: "Authorization error, no detail given (empty body)"
  'Forbidden':
    description: "Authentication error, no detail given (empty body)"
  'MediaTypeUnAccepted':
    description: "Unsupported media type requested, will be returned with an empty body if Accept header is not application/vnd.api+json"
  'UnsupportedMediaType':
    description: "Unsupported media type provided, no detail given (empty body)"
  'InternalError':
    description: "Server error, no detail given"
  
          
# Added by API Auto Mocking Plugin
host: virtserver.swaggerhub.com
# basePath: /edanielsen/Bills_Test/1.0.1
# Added by API Auto Mocking Plugin
basePath: /MYOB/Bills/1.0.1